/*!
 * Validetta (https://github.com/PixelUnion/validetta)
 * Version 2.0.0
 * Licensed under MIT (https://github.com/hsnayd/validetta/blob/master/LICENCE)
 * Copyright 2013-2015 Hasan AydoÄŸdu - http://www.hasanaydogdu.com 
 */
!function(e){"use strict";var t={},r=new RegExp(/^(minChecked|maxChecked|minSelected|maxSelected|minLength|maxLength|equalTo|different|regExp|remote|callback)\[(\w{1,15})\]/i),n=new RegExp(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/),a=new RegExp(/^[\-\+]?(\d+|\d+\.?\d+)$/),i={required:"This field is required.",email:"Your E-mail address appears to be invalid.",number:"You can enter only numbers in this field.",numMax:"Please enter a number less than {max}.",numMin:"Please enter a number greater than {min}.",numRange:"Please enter a number greater than {min} and less than {max}.",maxLength:"Maximum {count} characters allowed.",minLength:"Minimum {count} characters allowed.",maxChecked:"Maximum {count} options allowed.",minChecked:"Please select minimum {count} options.",maxSelected:"Maximum {count} selection allowed.",minSelected:"Minimum {count} selection allowed.",notEqual:"Fields do not match.",different:"Fields cannot be the same as each other",creditCard:"Invalid credit card number."},s={showErrorMessage:!0,showMultiple:!1,disableNative:!0,inputWrapperClass:"form-field",errorTemplateClass:"form-inline-message",errorClass:"form-field-invalid",validClass:"form-field-valid",realTime:!1,onValid:function(){},onError:function(){},validators:{}},l=function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,""):e},o={required:function(e,t){switch(e.el.type){case"checkbox":return e.el.checked||i.required;case"radio":return this.radio.call(t,e.el)||i.required;case"select-multiple":return null!==e.val||i.required;case"select-one":return null!==e.val||i.required;default:return""!==e.val||i.required}},email:function(e){return n.test(e.val)||i.email},number:function(e,t){if(a.test(e.val)){var r,n=parseInt(e.val,10),s=e.el.max?parseInt(e.el.max,10):1/0,l=e.el.min?parseInt(e.el.min,10):-(1/0);if(e.el.max&&e.el.min)r=i.numRange;else if(e.el.max)r=i.numMax;else{if(!e.el.min)return!0;r=i.numMin}return n>=l&&s>=n?!0:t.processNumberMessage(r,e.el.min,e.el.max)}return i.number},minLength:function(e){var t=e.val.length;return 0===t||t>=e.arg||i.minLength.replace("{count}",e.arg)},maxLength:function(e){return e.val.length<=e.arg||i.maxLength.replace("{count}",e.arg)},equalTo:function(e,t){return t.form.querySelector('input[name="'+e.arg+'"]').value===e.val||i.notEqual},different:function(e,t){return t.form.querySelector('input[name="'+e.arg+'"]').value!==e.val||i.different},creditCard:function(e){if(""===e.val)return!0;var t,r,n,a,s,l,o,u=0;if(t=new RegExp(/[^0-9]+/g),r=e.val.replace(t,""),o=r.length,16>o)return i.creditCard;for(s=0;o>s;s++)n=o-s,a=parseInt(r.substring(n-1,n),10),s%2===1?(l=2*a,l>9&&(l=1+(l-10))):l=a,u+=l;return u>0&&u%10===0?!0:i.creditCard},maxChecked:function(t,r){var n=e(r.form.querySelectorAll('input[type=checkbox][name="'+t.el.name+'"]'));if(0===n.index(t.el)){var a=n.filter(":checked").length;if(0!==a)return a<=t.arg||i.maxChecked.replace("{count}",t.arg)}},minChecked:function(t,r){var n=e(r.form.querySelectorAll('input[type=checkbox][name="'+t.el.name+'"]'));if(0===n.index(t.el)){var a=n.filter(":checked").length;return a>=t.arg||i.minChecked.replace("{count}",t.arg)}},maxSelected:function(e){return null!==e.val?e.val.length<=e.arg||i.maxSelected.replace("{count}",e.arg):void 0},minSelected:function(e){return null!==e.val&&e.val.length>=e.arg||i.minSelected.replace("{count}",e.arg)},radio:function(e){var t=this.form.querySelectorAll('input[type=radio][name="'+e.name+'"]:checked').length;return 1===t},regExp:function(e,t){var r=t.options.validators.regExp[e.arg],n=new RegExp(r.pattern);return n.test(e.val)||r.errorMessage},remote:function(e){e.remote=e.arg},callback:function(e,t){var r=t.options.validators.callback[e.arg];return r.callback(e.el,e.val)||r.errorMessage}},u=function(t,r){this.handler=!1,this.options=e.extend(!0,{},s,r),this.form=t,this.xhr={},this.initializeForm(),this.events()};u.prototype={constructor:u,initializeForm:function(){this.options.disableNative&&this.form.setAttribute("novalidate",!0)},events:function(){var r=this;e(this.form).submit(function(e){return t=e.currentTarget.getElementsByTagName("input"),r.init(e)}),this.options.realTime===!0&&(e(this.form).find("input").not("[type=checkbox]").on("change",function(n){return t=e(this),r.init(n)}),e(this.form).find("input[type=checkbox]").on("click",function(e){return t=r.form.querySelectorAll('input[type=checkbox][name="'+this.name+'"]'),r.init(e)})),e(this.form).on("reset",function(){return e(r.form.querySelectorAll("."+r.options.errorClass+" , ."+r.options.validClass)).removeClass(r.options.errorClass+" "+r.options.validClass),r.reset()})},init:function(e){return this.reset(t),this.checkFields(e),"submit"!==e.type?void 0:"pending"===this.handler?!1:this.handler===!0?(this.options.onError.call(this,e),!1):this.options.onValid.call(this,e)},checkFields:function(n){var a=this,i=[];this.getInvalidFields=function(){return i};for(var s=0,u=t.length;u>s;s++)if(!t[s].disabled){var d,c=t[s],h="",m=l(e(c).val()),p=a.getInputValidators(c);this.tmp={},this.tmp={el:c,val:m,parent:this.parents(c)};for(var f=0,v=p.length;v>f;f++){var g,x=p[f].match(r);if(null!==x?("undefined"!=typeof x[2]&&(this.tmp.arg=x[2]),g=x[1]):g=p[f],(""!==m||"required"===g||"equalTo"===g)&&o.hasOwnProperty(g)&&(d=o[g](a.tmp,a),"undefined"!=typeof d&&d!==!0)){var C=c.getAttribute("data-vd-message-"+g);null!==C&&(d=C,"number"===g&&(d=this.processNumberMessage(d,this.tmp.el.min,this.tmp.el.max))),this.options.showMultiple?h+=d+"<br>":h=d}}""!==h?(i.push({field:c,errors:h}),this.addErrorClass(this.tmp.parent),this.notify.show.call(this,c,h)):"undefined"!=typeof this.tmp.remote?this.checkRemote(c,n):("undefined"!=typeof d?this.addValidClass(this.tmp.parent):e(this.tmp.parent).removeClass(this.options.errorClass+" "+this.options.validClass),d=void 0)}},getInputValidators:function(e){var t=e.hasAttribute("data-validates")?e.getAttribute("data-validates").split(","):[];return e.required&&-1===t.indexOf("required")&&t.push("required"),"number"===e.type&&-1===t.indexOf("number")&&t.push("number"),"email"===e.type&&-1===t.indexOf("email")&&t.push("email"),t},checkRemote:function(t,r){var n={},a={},i=t.name||t.id;"undefined"==typeof this.remoteCache&&(this.remoteCache={}),a[i]=this.tmp.val,n=e.extend(!0,{},{data:a},this.options.validators.remote[this.tmp.remote]||{});var s=e.param(n),l=this.remoteCache[s];if("undefined"!=typeof l)switch(l.state){case"pending":this.handler="pending",l.event=r.type;break;case"rejected":throw r.preventDefault(),new Error(l.result.message);case"resolved":l.result.valid===!1?(this.addErrorClass(this.tmp.parent),this.notify.show.call(this,t,l.result.message)):this.addValidClass(this.tmp.parent)}else{var o=this.xhr[i];"undefined"!=typeof o&&"pending"===o.state()&&o.abort(),l=this.remoteCache[s]={state:"pending",event:r.type},this.remoteRequest(n,l,t,i)}},remoteRequest:function(t,r,n,a){var i=this;e(this.tmp.parent).addClass("validetta-pending"),this.xhr[a]=e.ajax(t).done(function(t){"object"!=typeof t&&(t=JSON.parse(t)),r.state="resolved",r.result=t,"submit"===r.event?(i.handler=!1,e(i.form).trigger("submit")):t.valid===!1?(i.addErrorClass(i.tmp.parent),i.notify.show.call(i,n,t.message)):i.addValidClass(i.tmp.parent)}).fail(function(e,t){if("abort"!==t){var n="Ajax request failed for field ("+a+") : "+e.status+" "+e.statusText;throw r.state="rejected",r.result={valid:!1,message:n},new Error(n)}}).always(function(){e(i.tmp.parent).removeClass("validetta-pending")}),this.handler="pending"},notify:{show:function(e,t){if(!this.options.showErrorMessage)return void(this.handler=!0);var r=this.parents(e);if("undefined"==typeof r&&(r=e[0].parentNode),!r.querySelectorAll("."+this.options.errorTemplateClass).length){var n=document.createElement("span");n.className=this.options.errorTemplateClass,r.appendChild(n),n.innerHTML=t,this.handler=!0}},hide:function(e){e.parentNode.removeChild(e)}},reset:function(e){var t={};t="undefined"==typeof e||e.length>1&&"checkbox"!==e[0].type?this.form.querySelectorAll("."+this.options.errorTemplateClass):this.parents(e[0]).querySelectorAll("."+this.options.errorTemplateClass);for(var r=0,n=t.length;n>r;r++)this.notify.hide.call(this,t[r]);this.handler=!1},addErrorClass:function(t){e(t).removeClass(this.options.validClass).addClass(this.options.errorClass)},addValidClass:function(t){e(t).removeClass(this.options.errorClass).addClass(this.options.validClass)},parents:function(t){return e(t).parents("."+this.options.inputWrapperClass)[0]},processNumberMessage:function(e,t,r){return t&&(e=e.replace("{min}",t)),r&&(e=e.replace("{max}",r)),e}},e.fn.validetta=function(t,r){return e.validettaLanguage&&(i=e.extend(!0,{},i,e.validettaLanguage.messages)),"undefined"!=typeof r&&(i=e.extend(!0,{},i,r)),this.each(function(){new u(this,t)})}}(jQuery);